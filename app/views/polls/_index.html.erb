<div class="container poll-container center">
  <h1>Polls</h1>
<% if current_user == @event.user %>
    <%= simple_form_for([@event, @new_poll]) do |f| %>
      <%= f.input :event_id, as: :hidden, input_html: { value: @event.id } %>
      <%= f.input :title, label: "Poll Title" %>
      <%= f.simple_fields_for :choices do |choice_form| %>
        <%= choice_form.input :answer, label: "Option 1" %>
      <% end %>
      <%= f.simple_fields_for :choices do |choice_form| %>
        <%= choice_form.input :answer, label: "Option 2" %>
      <% end %>
      <%= f.simple_fields_for :choices do |choice_form| %>
        <%= choice_form.input :answer, label: "Option 3" %>
      <% end %>
      <%= f.simple_fields_for :choices do |choice_form| %>
        <%= choice_form.input :answer, label: "Option 4" %>
      <% end %>
      <%= f.submit class: "btn btn-outline-danger" %>
    <% end %>
<% end %>

</div>

<!-- LATEST POLL -->

<% if @event.polls.any? %>
  <h2 class="center m-3"><%= @event.polls.last.title %></h2>
  <div class="center m-3">
    <% @event.polls.last.choices.each do |choice| %>
      <%= simple_form_for Response.new, remote: true do |f| %>
        <%= f.input :choice_id, as: :hidden, input_html: { value: choice.id } %>
        <div>
          <%= f.submit "#{choice.answer}", class: "btn btn-secondary btn-lg poll-button" %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>

<!-- LATEST POLL -->

<% if !@event.polls.empty? && @event.polls.count > 1 %>
    <div class="center m-5">
      <%= link_to "See previous polls", "#{params[:id]}/polls", class: "btn btn-danger"%>
    </div>
<% end %>

<h3 class="center m-3">Poll results</h3>
<% unless @event.polls == nil || @event.polls.empty? %>
  <% @event.polls.each do |poll|  %>
    <div class="card-box-wide card-box-poll">
      <h4><%= poll.title %></h4>
      <div class="d-flex justify-content-center mb-5">
        <%= bar_chart poll.responses.group("choices.answer").count, dataset: {barThickness: 20}, width: "80%", height: "300px", colors: ['#800000'] %>
      </div>
    </div>
  <% end %>
<% else %>
  <h5 class="center">No Polls for this event</h5>
<% end %>
